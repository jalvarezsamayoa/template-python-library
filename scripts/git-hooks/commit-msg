#!/bin/bash

# Conventional Commits regex
# Types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert
# Allows optional scope in parentheses
# Allows optional ! for breaking changes
# Requires a space after the colon
COMMIT_MSG_REGEX="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([a-z0-9_-]+\))?!?: .+"

# Standard merge message regex
MERGE_MSG_REGEX="^Merge .+"

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

if [[ ! $COMMIT_MSG =~ $COMMIT_MSG_REGEX ]] && [[ ! $COMMIT_MSG =~ $MERGE_MSG_REGEX ]]; then
    echo -e "\e[31mError: Invalid commit message format.\e[0m"
    echo -e "Your commit message must follow the Conventional Commits specification:"
    echo -e "  <type>(<scope>)?: <description>"
    echo -e ""
    echo -e "Allowed types: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert"
    echo -e "Example: feat(api): add new greeting endpoint"
    echo -e ""
    echo -e "Merge messages (e.g., 'Merge branch...') are also allowed."
    exit 1
fi
